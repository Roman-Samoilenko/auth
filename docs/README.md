# Сервис аутентификации

## Техническое описание

Микросервис аутентификации написан на Go с использованием стандартной библиотеки net/http. Реализует JWT аутентификацию с поддержкой PostgreSQL для хранения учетных данных пользователей. Сервис предоставляет единый endpoint для входа и регистрации пользователей.

### Технологический стек

**Runtime:** Go с стандартной библиотекой net/http  
**База данных:** PostgreSQL с драйвером lib/pq  
**Аутентификация:** JWT токены через golang-jwt/jwt/v5  
**Логирование:** Структурированные логи через log/slog  
**Криптография:** bcrypt для хеширования паролей  

### Архитектура

**Handlers Layer:** HTTP обработчики запросов с реализацией ServeHTTP интерфейса  
**Storage Layer:** Абстракция базы данных через интерфейсы ManagerDB и ManagerTable  
**Service Layer:** Бизнес-логика создания JWT токенов  
**Middleware:** Компоненты для логирования и восстановления после паники  

### Структура базы данных

**Users Table:** Таблица пользователей с полями id, login, pass_hash, created_at  
**Indexes:** Уникальный индекс на поле login для предотвращения дублирования

### Безопасность

Пароли хешируются через bcrypt с DefaultCost параметром. JWT токены подписываются HMAC-SHA256 алгоритмом с секретным ключом из переменных окружения.

## Функциональность

**Auth Endpoint:** Один endpoint `/auth` обрабатывает вход и регистрацию  
**Registration:** Автоматическая регистрация при отсутствии логина в базе  
**Password Validation:** Проверка пароля через bcrypt сравнение хешей  
**JWT Generation:** Создание токенов с временем истечения 1 час  
**Cookie Management:** Установка HTTP-only cookies для безопасной передачи токенов

## Архитектурные решения

**Interface-based Design:** Использование интерфейсов ManagerDB для абстракции от конкретной СУБД  
**Context Timeouts:** Контекстные таймауты 5 секунд для операций с базой данных  
**Graceful Shutdown:** Корректное завершение работы по сигналу прерывания  
**Structured Logging:** JSON логирование всех операций с контекстной информацией  
**Error Handling:** Централизованная обработка ошибок с детальным логированием

## Производительность

Горутины используются для асинхронных операций с базой данных. Пул соединений PostgreSQL управляется автоматически драйвером. Timeout конфигурация предотвращает блокирование запросов. Middleware для восстановления после паники обеспечивает стабильность сервиса.
